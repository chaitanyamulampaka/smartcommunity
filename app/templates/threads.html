<!DOCTYPE html>
<html lang="en" class="scroll-smooth dark">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Threads â€¢ SmartCommunity</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<style>
		:root {
			--bg: #f7f8fb;
			--card: rgba(255,255,255,0.85);
			--border: rgba(15,23,42,0.08);
			--text: #0f172a;
			--muted: #6b7280;
			--accent1: #3b82f6;
			--accent2: #8b5cf6;
			--accent3: #14b8a6;
		}
		.dark {
			--bg: #0f172a;
			--card: rgba(15,23,42,0.7);
			--border: rgba(255,255,255,0.08);
			--text: #e2e8f0;
			--muted: #94a3b8;
		}
		body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); }
		.glass {
			background: var(--card);
			backdrop-filter: blur(10px);
			-webkit-backdrop-filter: blur(10px);
			border: 1px solid var(--border);
		}
		.card-hover { transition: transform .2s ease, box-shadow .2s ease; }
		.card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0,0,0,.08); }
		.btn-brand { background: linear-gradient(90deg, var(--accent1), var(--accent2)); }
		.btn-brand:hover { filter: brightness(1.05); transform: translateY(-1px); }
		.toggle { transition: background .2s ease, transform .2s ease; }
		.fade-in { animation: fade .3s ease; }
		@keyframes fade { from { opacity: 0; transform: translateY(6px);} to { opacity: 1; transform: translateY(0);} }
		.like-btn { transition: all .2s ease; }
		.like-btn:hover { transform: scale(1.1); }
		.like-btn.liked { animation: heartBeat .3s ease; }
		@keyframes heartBeat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
		.save-btn { transition: all .2s ease; }
		.save-btn:hover { transform: scale(1.1); }
		.save-btn.saved { animation: bounce .3s ease; }
		@keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
		.comment-btn { transition: all .2s ease; }
		.comment-btn:hover { transform: scale(1.05); }
		.thread-card { transition: all .3s ease; }
		.thread-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,.1); }
		.gradient-text { background: linear-gradient(90deg, var(--accent1), var(--accent2)); -webkit-background-clip: text; background-clip: text; color: transparent; }
		.pulse { animation: pulse 2s infinite; }
		@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .7; } }
	</style>
</head>
<body class="min-h-screen">
	<!-- Top Nav -->
	<nav class="glass sticky top-0 z-50 px-4 sm:px-6 py-3">
		<div class="max-w-7xl mx-auto flex items-center gap-3 sm:gap-6">
			<div class="flex items-center gap-2 shrink-0">
				<div class="w-9 h-9 rounded-full flex items-center justify-center" style="background: linear-gradient(135deg, var(--accent1), var(--accent2));">
					<svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
						<path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
					</svg>
				</div>
				<div class="hidden sm:block font-bold gradient-text">SmartCommunity</div>
			</div>
			<!-- Search -->
			<div class="flex-1 hidden md:block">
				<form method="get" action="{% url 'search_threads' %}" class="glass rounded-full px-4 py-2 flex items-center gap-2">
					<svg class="w-5 h-5 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M10 18a8 8 0 100-16 8 8 0 000 16z"/></svg>
					<input name="q" value="{{ search_query }}" class="bg-transparent outline-none w-full placeholder:opacity-60" placeholder="Search threads, tags, users..." />
					<button type="submit" class="opacity-60 hover:opacity-100">
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
					</button>
				</form>
			</div>
			<div class="ml-auto flex items-center gap-2 sm:gap-3">
				<!-- Saved Threads Link -->
				<a href="{% url 'saved_threads' %}" class="glass rounded-full p-2 hover:opacity-80 transition-opacity" title="Saved Threads">
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
					</svg>
				</a>
				<!-- Dark/Light Toggle -->
				<button id="themeToggle" class="glass rounded-full p-2 toggle" title="Toggle theme">
					<svg id="sunIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M10 15a5 5 0 100-10 5 5 0 000 10zm0 5a1 1 0 011-1h0a1 1 0 110 2h0a1 1 0 01-1-1zM3.22 16.78a1 1 0 011.42 0h0a1 1 0 11-1.42 1.42h0a1 1 0 010-1.42zM2 10a1 1 0 011-1h0a1 1 0 110 2h0a1 1 0 01-1-1zm1.22-6.78a1 1 0 011.42 0h0a1 1 0 11-1.42-1.42h0a1 1 0 010 1.42zM10 2a1 1 0 011-1h0a1 1 0 110 2h0a1 1 0 01-1-1zm6.78 1.22a1 1 0 010-1.42h0a1 1 0 111.42 1.42h0a1 1 0 01-1.42 0zM18 10a1 1 0 011-1h0a1 1 0 110 2h0a1 1 0 01-1-1zm-1.22 6.78a1 1 0 010 1.42h0a1 1 0 11-1.42-1.42h0a1 1 0 011.42 0z"/></svg>
					<svg id="moonIcon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 116.707 2.707a8.001 8.001 0 1010.586 10.586z"/></svg>
				</button>
				<button class="glass rounded-full p-2 relative" title="Notifications">
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg>
					<span class="absolute -top-1 -right-1 w-2 h-2 rounded-full" style="background: var(--accent1);"></span>
				</button>
				<a href="{% url 'view_profile' %}">
				<div class="glass rounded-full p-1">
					<img src="{{ request.user.profile.profile_image.url|default:'' }}" alt="avatar" class="w-8 h-8 rounded-full object-cover" />
				</div>
				</a>
			</div>
		</div>
	</nav>

	<!-- Layout -->
	<main class="max-w-7xl mx-auto px-4 sm:px-6 py-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
		<!-- Center Column -->
		<section class="lg:col-span-2 space-y-6">
			<!-- Filters -->
			<div class="glass rounded-2xl p-4 sm:p-6">
				<div class="flex items-center gap-2 mb-4">
					<div class="w-2 h-2 rounded-full" style="background: var(--accent3);"></div>
					<h2 class="font-semibold gradient-text">Filters</h2>
				</div>
				<form method="get" class="flex flex-wrap items-center gap-3">
					{% if search_query %}
					<input type="hidden" name="q" value="{{ search_query }}">
					{% endif %}
					
					<!-- Tag Filter -->
					<select name="tag" class="glass rounded-full px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none">
						<option value="">All Tags</option>
						{% for tag in trending_tags %}
						<option value="{{ tag.name }}" {% if tag_filter == tag.name %}selected{% endif %}>{{ tag.name }}</option>
						{% endfor %}
					</select>
					
					<!-- Privacy Filter -->
					<select name="privacy" class="glass rounded-full px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none">
						<option value="">All Privacy</option>
						{% for value, label in privacy_choices %}
						<option value="{{ value }}" {% if privacy_filter == value %}selected{% endif %}>{{ label }}</option>
						{% endfor %}
					</select>
					
					<!-- Sort Filter -->
					<select name="sort" class="glass rounded-full px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none">
						<option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>Newest</option>
						<option value="popular" {% if sort_by == 'popular' %}selected{% endif %}>Most Popular</option>
						<option value="commented" {% if sort_by == 'commented' %}selected{% endif %}>Most Commented</option>
					</select>
					
					<button type="submit" class="glass rounded-full px-4 py-2 text-sm font-medium hover:opacity-80 transition-opacity">
						<svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.207A1 1 0 013 6.5V4z"/>
						</svg>
						Apply Filters
					</button>
					
					{% if search_query or tag_filter or privacy_filter or sort_by != 'newest' %}
					<a href="{% url 'threads' %}" class="glass rounded-full px-4 py-2 text-sm font-medium hover:opacity-80 transition-opacity">
						<svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
						</svg>
						Clear
					</a>
					{% endif %}
				</form>
			</div>
			
			<!-- Composer -->
			<div class="glass rounded-2xl p-4 sm:p-6 card-hover">
				<div class="flex items-center gap-2 mb-4">
					<div class="w-2 h-2 rounded-full" style="background: var(--accent1);"></div>
					<h2 class="font-semibold gradient-text">Create Thread</h2>
				</div>
				<form method="post" enctype="multipart/form-data">
					{% csrf_token %}
					<div class="flex items-start gap-3 sm:gap-4">
						<div class="relative">
							<img src="{{ request.user.profile.profile_image.url|default:'' }}" class="w-12 h-12 rounded-full object-cover border-2 border-white shadow-lg" alt="avatar" />
							<div class="absolute -bottom-1 -right-1 w-4 h-4 rounded-full bg-green-500 border-2 border-white"></div>
						</div>
						<div class="flex-1">
							{{ form.title }}
							{{ form.content }}
							<div class="mt-4 flex flex-wrap items-center gap-2">
								<label class="glass rounded-full px-3 py-2 flex items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity">
									<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
									</svg>
									{{ form.image }}
									<span class="text-sm">Image</span>
								</label>
								<div class="glass rounded-full px-3 py-2">
									<svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 010 5.656l-1.414 1.414a4 4 0 01-5.656-5.656l1.414-1.414"/>
									</svg>
									{{ form.link }}
								</div>

								<div class="glass rounded-full px-3 py-2">
									<svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
									</svg>
									{{ form.privacy }}
								</div>
							</div>
							<div class="mt-4 flex items-center justify-between">
								
								<button class="btn-brand text-white rounded-full px-6 py-2.5 font-semibold shadow-lg hover:shadow-xl transition-all">
									<svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
									</svg>
									Post Thread
								</button>
							</div>
						</div>
					</div>
				</form>
			</div>

			<!-- Threads List -->
			<div id="threadsContainer" class="space-y-6">
				{% for th in threads %}
				
<!-- ...inside your thread card, after the thread content and before tags... -->
<!-- ...inside your thread card, after the thread content and before tags/images... -->



				<div class="glass rounded-2xl p-5 sm:p-6 thread-card fade-in" data-thread-id="{{ th.id }}">
					{% if th.summary %}
<!-- AI Summary Card -->
<div class="bg-white dark:bg-gray-800 rounded-xl shadow-md card-hover overflow-hidden mb-8">
    <div class="p-6">
        <div class="flex items-start">
            
            <!-- Icon -->
            <div class="flex-shrink-0">
                
			<img src="/media/profile_photos/ai-technology.png" alt="AI Icon" class="h-6 w-6" />
                
            </div>

            <!-- Content -->
            <div class="ml-4 flex-1">
                <div class="flex items-center">
                    <h3 class="text-base font-bold text-gray-900 dark:text-white">AI-Generated Summary</h3>
                    <span class="ml-2 text-xs font-semibold text-purple-600 dark:text-purple-300 uppercase">AI</span>
                </div>
                <div class="mt-2 text-sm text-gray-600 dark:text-gray-300 leading-relaxed">
                    {{ th.summary }}
                </div>
            </div>
        </div>

        
    </div>
</div>
{% endif %}

					<div class="flex items-start gap-4">
						<div class="relative">
							<img src="{{ th.author.profile.profile_image.url }}" class="w-12 h-12 rounded-full object-cover border-2 border-white shadow-lg" />
							<div class="absolute -bottom-1 -right-1 w-4 h-4 rounded-full bg-green-500 border-2 border-white"></div>
						</div>
						<div class="flex-1 min-w-0">
							<div class="flex items-center justify-between mb-3">
								<div class="flex items-center gap-3">
									<div>
										<div class="font-semibold text-lg">{{ th.author.get_full_name|default:th.author.username }}</div>
										<div class="text-sm opacity-60 flex items-center gap-2">
											<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
											</svg>
											{{ th.created_at|timesince }} ago
										</div>
									</div>
									{% if th.privacy != 'public' %}
									<div class="glass px-2 py-1 rounded-full text-xs">
										<svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
										</svg>
										{{ th.privacy|title }}
									</div>
									{% endif %}
								</div>
								<button class="glass rounded-full p-2 opacity-60 hover:opacity-100 transition-opacity">
									<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
									</svg>
								</button>
							</div>
							<div class="prose prose-sm max-w-none">
								<p class="text-[16px] leading-relaxed mb-4">{{ th.content }}</p>
							</div>
							{% if th.image %}
							<div class="mb-4 rounded-2xl overflow-hidden shadow-lg">
								<img src="{{ th.image.url }}" class="w-full h-auto object-cover" alt="image" />
							</div>
							{% endif %}
							{% if th.link %}
							<div class="mb-4 glass rounded-xl p-3">
								<div class="flex items-center gap-2 mb-2">
									<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 010 5.656l-1.414 1.414a4 4 0 01-5.656-5.656l1.414-1.414"/>
									</svg>
									<span class="text-sm font-medium">Link</span>
								</div>
								<a href="{{ th.link }}" class="text-sm opacity-80 hover:opacity-100 underline" target="_blank">{{ th.link }}</a>
							</div>
							{% endif %}
							
							{% if th.tags.all %}
							<div class="mb-4 flex flex-wrap gap-2">
								{% for tag in th.tags.all %}
								<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200">
    #{{ tag.name }}
</span>
								{% endfor %}
							</div>
							{% endif %}
							<div class="flex items-center gap-6 text-sm">
								<button onclick="toggleLike({{ th.id }}, this)" class="like-btn flex items-center gap-2 hover:opacity-100 transition-all {% if request.user in th.likes.all %}text-red-500 liked{% endif %}">
									<svg class="w-5 h-5" fill="{% if request.user in th.likes.all %}currentColor{% else %}none{% endif %}" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
									</svg>
									<span class="like-count font-medium">{{ th.like_count }}</span>
								</button>
								<button onclick="toggleComments(this)" class="comment-btn flex items-center gap-2 hover:opacity-100 transition-all">
									<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
									</svg>
									<span class="font-medium comment-count">{{ th.comment_count }}</span>
								</button>
								<button onclick="toggleSave({{ th.id }}, this)" class="save-btn flex items-center gap-2 hover:opacity-100 transition-all {% if request.user in th.saves.all %}text-yellow-500 saved{% endif %}">
									<svg class="w-5 h-5" fill="{% if request.user in th.saves.all %}currentColor{% else %}none{% endif %}" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
									</svg>
									<span class="font-medium">Save</span>
								</button>
								<button class="flex items-center gap-2 hover:opacity-100 transition-all" onclick="navigator.clipboard.writeText(window.location.href); return false;">
									<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
									</svg>
									<span class="font-medium">Share</span>
								</button>
							</div>
							<div class="comments hidden mt-6" data-thread-id="{{ th.id }}">
								<div class="border-t pt-4">
									<h4 class="font-semibold mb-4 flex items-center gap-2">
										<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
										</svg>
										Comments ({{ th.comment_count }})
									</h4>
									<div class="space-y-4">
										{% for c in th.comments.all %}
										<div class="flex items-start gap-3">
											<img src="{{ c.author.profile.profile_image.url }}" class="w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm" />
											<div class="flex-1">
												<div class="glass rounded-2xl p-4">
													<div class="flex items-center gap-2 mb-2">
														<div class="font-semibold">{{ c.author.get_full_name|default:c.author.username }}</div>
														<div class="text-xs opacity-60">Â· {{ c.created_at|timesince }} ago</div>
													</div>
													<div class="text-sm leading-relaxed">{{ c.content }}</div>
												</div>
											</div>
										</div>
										{% empty %}
										<div class="text-center py-8 opacity-60">
											<svg class="w-12 h-12 mx-auto mb-3 opacity-40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
											</svg>
											<div class="text-sm">No comments yet. Be the first to comment!</div>
										</div>
										{% endfor %}
									</div>
									<form onsubmit="submitComment(event, {{ th.id }})" class="mt-6">
										{% csrf_token %}
										<div class="flex items-start gap-3">
											<img src="{{ request.user.profile.profile_image.url|default:'' }}" class="w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm" />
											<div class="flex-1">
												<textarea name="content" rows="3" class="w-full glass rounded-2xl p-4 outline-none resize-none" placeholder="Write a thoughtful comment..."></textarea>
												<input type="hidden" name="parent" value="">
												<div class="mt-3 flex items-center justify-between">
													<div class="text-xs opacity-60">Press Enter to submit</div>
													<button type="submit" class="btn-brand text-white rounded-full px-4 py-2 text-sm font-medium">
														<svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
														</svg>
														Reply
													</button>
												</div>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
				{% empty %}
				<div class="glass rounded-2xl p-6 text-center opacity-80">No threads yet. Start the conversation!</div>
				{% endfor %}
			</div>
			<!-- Pagination -->
			{% if threads.has_other_pages %}
			<div class="mt-8 flex justify-center">
				<div class="glass rounded-full p-2 flex items-center gap-2">
					{% if threads.has_previous %}
					<a href="?page={{ threads.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if tag_filter %}&tag={{ tag_filter }}{% endif %}{% if privacy_filter %}&privacy={{ privacy_filter }}{% endif %}{% if sort_by != 'newest' %}&sort={{ sort_by }}{% endif %}" class="glass rounded-full p-2 hover:opacity-80 transition-opacity">
						<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
						</svg>
					</a>
					{% endif %}
					
					<span class="px-4 text-sm font-medium">{{ threads.number }} of {{ threads.paginator.num_pages }}</span>
					
					{% if threads.has_next %}
					<a href="?page={{ threads.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if tag_filter %}&tag={{ tag_filter }}{% endif %}{% if privacy_filter %}&privacy={{ privacy_filter }}{% endif %}{% if sort_by != 'newest' %}&sort={{ sort_by }}{% endif %}" class="glass rounded-full p-2 hover:opacity-80 transition-opacity">
						<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
						</svg>
					</a>
					{% endif %}
				</div>
			</div>
			{% endif %}
			
			<!-- Infinite scroll sentinel -->
			<div id="sentinel" class="h-8"></div>
		</section>

		<!-- Right Sidebar -->
		<aside class="space-y-6">
			<div class="glass rounded-2xl p-6 card-hover">
				<div class="flex items-center gap-2 mb-4">
					<div class="w-2 h-2 rounded-full" style="background: var(--accent2);"></div>
					<h2 class="font-semibold gradient-text">Trending Tags</h2>
				</div>
				<div class="flex flex-wrap gap-2">
					{% for tag in trending_tags %}
					<a href="{% url 'tag_threads' tag.name %}" class="glass px-3 py-2 rounded-full text-sm hover:opacity-100 opacity-80 transition-all hover:scale-105" style="background: linear-gradient(135deg, var(--accent1), var(--accent2)); color: white;">#{{ tag.name }} ({{ tag.thread_count }})</a>
					{% empty %}
					<div class="text-center py-8 opacity-60">
						<svg class="w-12 h-12 mx-auto mb-3 opacity-40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h10M7 11h8M7 15h6"/>
						</svg>
						<div class="text-sm">No trends yet</div>
					</div>
					{% endfor %}
				</div>
			</div>
			<div class="glass rounded-2xl p-6 card-hover">
				<div class="flex items-center gap-2 mb-4">
					<div class="w-2 h-2 rounded-full" style="background: var(--accent3);"></div>
					<h2 class="font-semibold gradient-text">Who to Follow</h2>
				</div>
				<div class="space-y-4">
					{% for user in suggested_users %}
					<div class="flex items-center justify-between p-3 glass rounded-xl hover:opacity-80 transition-opacity">
						<div class="flex items-center gap-3 min-w-0">
							<div class="relative">
								<img src="{{ user.profile.profile_image.url }}" class="w-12 h-12 rounded-full object-cover border-2 border-white shadow-sm" />
								<div class="absolute -bottom-1 -right-1 w-4 h-4 rounded-full bg-green-500 border-2 border-white"></div>
							</div>
							<div class="min-w-0">
								<div class="font-semibold truncate">{{ user.get_full_name|default:user.username }}</div>
								<div class="text-xs opacity-60 truncate">@{{ user.username }}</div>
							</div>
						</div>
						<a href="{% url 'follow_toggle' user.id %}" class="glass rounded-full px-4 py-2 text-sm font-medium hover:scale-105 transition-transform" style="background: linear-gradient(135deg, var(--accent1), var(--accent2)); color: white;">Follow</a>
					</div>
					{% empty %}
					<div class="text-center py-8 opacity-60">
						<svg class="w-12 h-12 mx-auto mb-3 opacity-40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
						</svg>
						<div class="text-sm">You're all caught up!</div>
					</div>
					{% endfor %}
				</div>
			</div>
		</aside>
	</main>

	<!-- FAB for mobile -->
	<button id="fab" class="fixed bottom-6 right-6 sm:hidden btn-brand text-white w-14 h-14 rounded-full shadow-xl">+
	</button>

	<script>
		// Theme toggle with persistence
		const root = document.documentElement;
		const themeToggle = document.getElementById('themeToggle');
		const sunIcon = document.getElementById('sunIcon');
		const moonIcon = document.getElementById('moonIcon');
		function applyTheme(mode){
			if(mode === 'dark') { root.classList.add('dark'); sunIcon.classList.remove('hidden'); moonIcon.classList.add('hidden'); }
			else { root.classList.remove('dark'); sunIcon.classList.add('hidden'); moonIcon.classList.remove('hidden'); }
		}
		const saved = localStorage.getItem('theme') || 'dark';
		applyTheme(saved);
		themeToggle.addEventListener('click', () => {
			const next = root.classList.contains('dark') ? 'light' : 'dark';
			localStorage.setItem('theme', next);
			applyTheme(next);
		});

		// Simple infinite scroll demo (adds placeholder cards)
		const container = document.getElementById('threadsContainer');
		const sentinel = document.getElementById('sentinel');
		let loading = false;
		const makeCard = (i) => {
			const div = document.createElement('div');
			div.className = 'glass rounded-2xl p-4 sm:p-5 card-hover fade-in';
			div.innerHTML = `
				<div class="flex items-start gap-3">
					<img src="https://placehold.co/40" class="w-10 h-10 rounded-full" />
					<div class="flex-1 min-w-0">
						<div class="flex items-center justify-between">
							<div class="flex items-center gap-2">
								<span class="font-semibold truncate">Guest User</span>
								<span class="opacity-60 text-sm">Â· just now</span>
							</div>
							<button class="opacity-60 hover:opacity-100">â€¢â€¢â€¢</button>
						</div>
						<p class="mt-2 text-[15px]">New placeholder thread #${i} â€” keep scrolling!</p>
					</div>
				</div>`;
			return div;
		};
		const io = new IntersectionObserver(entries => {
			entries.forEach(entry => {
				if(entry.isIntersecting && !loading) {
					loading = true;
					setTimeout(() => {
						for(let i=0;i<3;i++) container.appendChild(makeCard(Math.floor(Math.random()*10000)));
						loading = false;
					}, 400);
				}
			});
		});
		io.observe(sentinel);

		// FAB opens composer
		document.getElementById('fab').addEventListener('click', () => {
			window.scrollTo({ top: 0, behavior: 'smooth' });
		});

		// WebSocket client for live updates
		(function(){
			const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';
			const wsUrl = `${protocol}://${window.location.host}/ws/threads/`;
			let socket;
			function connect(){
				socket = new WebSocket(wsUrl);
				socket.onopen = () => { try { socket.send(JSON.stringify({type:'ping'})); } catch(e){} };
				socket.onmessage = (event) => {
					try {
						const data = JSON.parse(event.data);
						if (data.event === 'thread_liked') {
							const card = document.querySelector('[data-thread-id="' + data.thread_id + '"]');
							if (card) {
								const count = card.querySelector('.like-count');
								if (count) count.textContent = data.likes;
							}
						}
						if (data.event === 'comment_created') {
							const card = document.querySelector('[data-thread-id="' + data.thread_id + '"]');
							if (card) {
								const cc = card.querySelector('.comment-count');
								if (cc) { cc.textContent = String(parseInt(cc.textContent || '0') + 1); }
							}
						}
						if (data.event === 'thread_created') {
							// Lightweight notice; production could prepend rendered card via AJAX fetch
							const notice = document.createElement('div');
							notice.className = 'fixed bottom-4 left-1/2 -translate-x-1/2 glass rounded-full px-4 py-2 text-sm';
							notice.textContent = 'New thread by ' + (data.author || 'someone');
							document.body.appendChild(notice);
							setTimeout(() => notice.remove(), 2500);
						}
					} catch(e) { console.warn('WS parse error', e); }
				};
				socket.onclose = () => { setTimeout(connect, 2000); };
			}
			connect();
		})();

		// AJAX functions
		async function toggleLike(threadId, button) {
			try {
				const response = await fetch(`/u/${threadId}/like-toggle/`, {
					headers: { 'X-Requested-With': 'XMLHttpRequest' }
				});
				const data = await response.json();
				if (data.ok) {
					const countSpan = button.querySelector('.like-count');
					const heartIcon = button.querySelector('svg');
					countSpan.textContent = data.likes;
					
					if (button.classList.contains('text-red-500')) {
						button.classList.remove('text-red-500', 'liked');
						heartIcon.setAttribute('fill', 'none');
					} else {
						button.classList.add('text-red-500', 'liked');
						heartIcon.setAttribute('fill', 'currentColor');
					}
				}
			} catch (error) {
				console.error('Error toggling like:', error);
			}
		}

		async function toggleSave(threadId, button) {
			try {
				const response = await fetch(`/u/${threadId}/save-toggle/`, {
					headers: { 'X-Requested-With': 'XMLHttpRequest' }
				});
				const data = await response.json();
				if (data.ok) {
					const bookmarkIcon = button.querySelector('svg');
					
					if (button.classList.contains('text-yellow-500')) {
						button.classList.remove('text-yellow-500', 'saved');
						bookmarkIcon.setAttribute('fill', 'none');
					} else {
						button.classList.add('text-yellow-500', 'saved');
						bookmarkIcon.setAttribute('fill', 'currentColor');
					}
				}
			} catch (error) {
				console.error('Error toggling save:', error);
			}
		}

		function toggleComments(button) {
			const commentsDiv = button.closest('.glass').querySelector('.comments');
			commentsDiv.classList.toggle('hidden');
		}

		async function submitComment(event, threadId) {
			event.preventDefault();
			const form = event.target;
			const content = form.querySelector('textarea[name="content"]').value.trim();
			if (!content) return;

			try {
				const response = await fetch(`/u/${threadId}/comment/`, {
					method: 'POST',
					headers: {
						'X-Requested-With': 'XMLHttpRequest',
						'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
					},
					body: new FormData(form)
				});
				
				if (response.ok) {
					// Clear form and refresh comments
					form.querySelector('textarea[name="content"]').value = '';
					location.reload(); // Simple refresh for now
				}
			} catch (error) {
				console.error('Error submitting comment:', error);
			}
		}
	</script>
</body>
</html>


